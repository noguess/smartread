import React, { useState, useEffect } from 'react';
import {
Clock,
BookOpen,
ChevronLeft,
Type,
Minus,
Plus,
Play,
Pause,
History,
Trophy,
ArrowRight,
MoreVertical,
Highlighter,
Maximize2,
Calendar,
Search,
CheckCircle2
} from 'lucide-react';

const ArticleReader = () => {
// 1. 阅读计时逻辑
const [seconds, setSeconds] = useState(0);
const [isTimerRunning, setIsTimerRunning] = useState(true);

useEffect(() => {
let interval = null;
if (isTimerRunning) {
interval = setInterval(() => {
setSeconds(seconds => seconds + 1);
}, 1000);
}
return () => clearInterval(interval);
}, [isTimerRunning]);

const formatTime = (totalSeconds) => {
const m = Math.floor(totalSeconds / 60).toString().padStart(2, '0');
const s = (totalSeconds % 60).toString().padStart(2, '0');
return `${m}:${s}`;
};

// 2. 字体大小控制 (默认调大一点，提升可读性)
const [fontSize, setFontSize] = useState(19);

// 3. 模拟核心词汇数据
const vocabulary = [
{ word: "lonely", type: "adj.", trans: "孤独的", context: "felt lonely in his new class" },
{ word: "habit", type: "n.", trans: "习惯", context: "had a habit of staying alone" },
{ word: "design", type: "v.", trans: "设计", context: "plan a project to design" },
{ word: "temperature", type: "n.", trans: "温度", context: "when the temperature was high" },
{ word: "influence", type: "n.", trans: "影响", context: "positive attitude had a good influence" },
{ word: "satisfied", type: "adj.", trans: "满意的", context: "He felt satisfied with his work" },
{ word: "wonder", type: "v.", trans: "想知道", context: "started to wonder about nature" },
{ word: "smell", type: "n.", trans: "气味", context: "The smell of flowers made him happy" },
{ word: "peaceful", type: "adj.", trans: "宁静的", context: "garden was peaceful" },
{ word: "reduce", type: "v.", trans: "减少", context: "reduce loneliness" },
];

// 4. 模拟测试记录数据
const testHistory = [
{ id: 1, date: "12月10日", score: 85, duration: "2m 10s" },
{ id: 2, date: "12月08日", score: 60, duration: "1m 45s" },
];

// 高亮交互状态
const [activeWord, setActiveWord] = useState(null);

// 渲染文章内容的辅助函数
const renderContent = () => {
const text = `Li Ming was a middle school student who often felt lonely in his new class. He had a habit of staying
alone after school. One day, his teacher asked him to join the school's environmental club. Li Ming was not sure, but he
decided to try.

At the club, they planned a project to design a garden for the school. Li Ming learned to bring tools and plants. He
started to wonder about nature. The smell of flowers made him happy. The club members worked hard, even when the
temperature was high. They wanted to save water and help the environment.

Li Ming's friends saw his change. They began to trust him more. His positive attitude had a good influence on others. He
felt satisfied with his work. It was true that helping others could reduce loneliness. The sound of birds in the garden
was peaceful.

As time passed, Li Ming realized that good habits could change a person's life. He no longer felt isolated but connected
to the world around him.`;

return text.split('\n\n').map((paragraph, idx) => (
<p key={idx} className="mb-8 leading-loose text-slate-700 transition-all duration-300" style={{ fontSize:
    `${fontSize}px`, lineHeight: '1.9' }}>
    {paragraph.split(' ').map((word, wIdx) => {
    const cleanWord = word.replace(/[^a-zA-Z]/g, '');
    const isVocab = vocabulary.find(v => v.word.toLowerCase() === cleanWord.toLowerCase());

    if (isVocab) {
    return (
    <span key={wIdx} onMouseEnter={()=> setActiveWord(isVocab.word)}
        onMouseLeave={() => setActiveWord(null)}
        className={`cursor-pointer rounded px-0.5 transition-colors duration-200 border-b-2 ${
        activeWord === isVocab.word
        ? 'bg-indigo-100 text-indigo-900 border-indigo-400 font-medium'
        : 'bg-transparent text-slate-700 border-indigo-100 hover:bg-indigo-50 hover:border-indigo-300'
        }`}
        >
        {word}{' '}
    </span>
    );
    }
    return word + ' ';
    })}
</p>
));
};

return (
<div className="min-h-screen bg-[#F8FAFC] font-sans text-slate-800 flex flex-col">

    {/* 顶部导航栏 - 去除复杂元素，保持极简专注 */}
    <header className="bg-white/80 backdrop-blur-md border-b border-slate-200/60 sticky top-0 z-50 h-16 transition-all">
        <div className="max-w-[1400px] mx-auto px-4 sm:px-6 h-full flex items-center justify-between">
            <div className="flex items-center gap-4">
                <button
                    className="w-9 h-9 flex items-center justify-center hover:bg-slate-100 rounded-full text-slate-500 transition-colors">
                    <ChevronLeft size={20} />
                </button>
                <h1 className="text-base font-semibold text-slate-700 hidden sm:block truncate max-w-md opacity-80">
                    Reading Mode
                </h1>
            </div>

            <div className="flex items-center gap-3 sm:gap-6">
                {/* 字体控制 */}
                <div className="flex items-center gap-1 bg-slate-100/80 rounded-full p-1 border border-slate-200">
                    <button onClick={()=> setFontSize(Math.max(14, fontSize - 1))}
                        className="w-7 h-7 flex items-center justify-center hover:bg-white rounded-full text-slate-500
                        shadow-sm transition-all disabled:opacity-50"
                        >
                        <Minus size={14} />
                    </button>
                    <div className="w-8 text-center text-xs font-medium text-slate-600">
                        {fontSize}
                    </div>
                    <button onClick={()=> setFontSize(Math.min(26, fontSize + 1))}
                        className="w-7 h-7 flex items-center justify-center hover:bg-white rounded-full text-slate-500
                        shadow-sm transition-all"
                        >
                        <Plus size={14} />
                    </button>
                </div>

                <div className="w-px h-4 bg-slate-300 hidden sm:block"></div>

                {/* 计时器 */}
                <div className="flex items-center gap-2">
                    <span className={`font-mono text-sm font-medium ${isTimerRunning ? 'text-indigo-600'
                        : 'text-slate-400' }`}>
                        {formatTime(seconds)}
                    </span>
                    <button onClick={()=> setIsTimerRunning(!isTimerRunning)}
                        className="w-8 h-8 flex items-center justify-center text-slate-500 hover:text-indigo-600
                        hover:bg-indigo-50 rounded-full transition-all"
                        title={isTimerRunning ? "暂停" : "继续"}
                        >
                        {isTimerRunning ?
                        <Pause size={16} fill="currentColor" /> :
                        <Play size={16} fill="currentColor" />}
                    </button>
                </div>
            </div>
        </div>
    </header>

    <main
        className="flex-1 max-w-[1400px] mx-auto w-full p-4 sm:p-6 lg:p-8 grid grid-cols-1 lg:grid-cols-12 gap-6 lg:gap-10 items-start relative">

        {/* === 主阅读区 (占比 9/12) === */}
        <section className="lg:col-span-9 order-1 min-h-[85vh]">
            <div className="bg-white rounded-[2rem] shadow-sm border border-slate-100 p-8 sm:p-12 lg:p-16 relative">

                {/* 头部元数据 */}
                <div className="mb-12 max-w-3xl">
                    <div className="flex flex-wrap items-center gap-3 mb-5">
                        <span
                            className="inline-flex items-center px-2.5 py-0.5 bg-emerald-50 text-emerald-700 border border-emerald-100 text-xs font-bold rounded-md tracking-wide uppercase">
                            Level 2
                        </span>
                        <span className="text-slate-400 text-xs flex items-center gap-1.5 font-medium">
                            <BookOpen size={14} /> 320 词
                        </span>
                        <span className="text-slate-300 text-[10px]">|</span>
                        <span className="text-slate-400 text-xs font-medium">约 4 分钟</span>
                    </div>
                    <h1
                        className="text-3xl sm:text-4xl lg:text-5xl font-bold text-slate-900 leading-[1.15] tracking-tight">
                        The Power of a Good Habit
                    </h1>
                </div>

                {/* 文章正文 - 限制最大宽度以保证阅读舒适度 (Max Width for Readability) */}
                <article
                    className="prose prose-slate prose-lg max-w-3xl prose-headings:text-slate-800 prose-p:text-slate-600">
                    {renderContent()}
                </article>

                {/* 底部互动 */}
                <div
                    className="mt-20 pt-8 border-t border-slate-100 flex justify-between items-center text-slate-400 text-sm max-w-3xl">
                    <div className="flex items-center gap-2">
                        <CheckCircle2 size={16} className="text-emerald-500" />
                        <span>已完成阅读</span>
                    </div>
                    <button className="flex items-center gap-1 hover:text-indigo-600 transition-colors group">
                        回到顶部
                        <ArrowRight size={14} className="-rotate-90 group-hover:-translate-y-1 transition-transform" />
                    </button>
                </div>
            </div>

            {/* 移动端测试入口 */}
            <div className="lg:hidden mt-6 bg-white rounded-2xl p-6 border border-slate-100 shadow-sm">
                <div className="flex items-center justify-between mb-4">
                    <h3 className="font-bold text-slate-800">章节测试</h3>
                    <span className="text-xs bg-indigo-50 text-indigo-600 px-2 py-1 rounded">5 题</span>
                </div>
                <button
                    className="w-full bg-indigo-600 text-white font-bold py-3 rounded-xl active:scale-95 transition-transform">开始挑战</button>
            </div>
        </section>


        {/* === 右侧侧边栏 (占比 3/12，Flex 布局解决高度问题) === */}
        <aside className="hidden lg:flex lg:col-span-3 order-2 sticky top-24 h-[calc(100vh-8rem)] flex-col gap-5">

            {/* 1. 测试入口 (视觉降噪版)
            不再是深色渐变，而是干净的白底+强调色边框，减少阅读时的压迫感
            */}
            <div
                className="bg-white rounded-2xl p-5 border-2 border-indigo-50 hover:border-indigo-100 shadow-sm transition-all group shrink-0 relative overflow-hidden">
                <div
                    className="absolute top-0 right-0 w-20 h-20 bg-indigo-50 rounded-full -mr-10 -mt-10 transition-transform group-hover:scale-110">
                </div>

                <div className="relative z-10">
                    <div className="flex items-center justify-between mb-3">
                        <h3 className="font-bold text-slate-800 text-lg">开始测试</h3>
                        <div
                            className="w-8 h-8 rounded-full bg-indigo-100 text-indigo-600 flex items-center justify-center">
                            <Trophy size={16} />
                        </div>
                    </div>
                    <p className="text-slate-500 text-xs mb-5 leading-relaxed">
                        检测阅读理解与词汇掌握情况。<br />
                        <span className="text-indigo-600 font-medium">当前最佳: 85分</span>
                    </p>
                    <button
                        className="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2.5 rounded-xl shadow-sm shadow-indigo-200 active:scale-95 transition-all flex items-center justify-center gap-2 text-sm">
                        <span>立即挑战</span>
                        <ArrowRight size={16} />
                    </button>
                </div>
            </div>

            {/* 2. 核心词汇 (中间部分，Flex-1 自动占据剩余空间并滚动) */}
            <div
                className="bg-white rounded-2xl shadow-sm border border-slate-100 flex-1 overflow-hidden flex flex-col min-h-0">
                <div className="p-4 border-b border-slate-50 flex justify-between items-center shrink-0">
                    <h2 className="font-bold text-slate-700 flex items-center gap-2 text-sm">
                        <Highlighter size={14} className="text-indigo-500" />
                        核心词汇
                    </h2>
                    <span className="text-[10px] bg-slate-100 text-slate-500 px-1.5 py-0.5 rounded-md font-medium">
                        {vocabulary.length}
                    </span>
                </div>
                {/* custom-scrollbar 需要在 CSS 中定义，这里用默认滚动条也能用 */}
                <div className="overflow-y-auto p-2 space-y-1 flex-1">
                    {vocabulary.map((item, index) => (
                    <div key={index} onMouseEnter={()=> setActiveWord(item.word)}
                        onMouseLeave={() => setActiveWord(null)}
                        className={`p-3 rounded-xl cursor-pointer transition-all border group ${
                        activeWord === item.word
                        ? 'bg-indigo-50 border-indigo-200 shadow-sm translate-x-1'
                        : 'bg-white border-transparent hover:bg-slate-50 hover:border-slate-100'
                        }`}
                        >
                        <div className="flex justify-between items-baseline mb-0.5">
                            <span className={`font-bold text-sm ${activeWord===item.word ? 'text-indigo-700'
                                : 'text-slate-700' }`}>
                                {item.word}
                            </span>
                            <span
                                className="text-[10px] text-slate-400 italic font-serif opacity-0 group-hover:opacity-100 transition-opacity">{item.type}</span>
                        </div>
                        <div className="text-xs text-slate-500 group-hover:text-slate-700 truncate">{item.trans}</div>
                    </div>
                    ))}
                </div>
            </div>

            {/* 3. 历史记录 (底部固定，不会被挤掉) */}
            <div className="bg-white rounded-2xl shadow-sm border border-slate-100 p-4 shrink-0">
                <div className="flex items-center justify-between mb-3">
                    <span
                        className="text-[10px] font-bold text-slate-400 uppercase tracking-wider flex items-center gap-1">
                        <History size={10} /> 最近记录
                    </span>
                </div>
                <div className="space-y-2">
                    {testHistory.map((record) => (
                    <div key={record.id}
                        className="flex items-center justify-between text-xs p-1.5 rounded-lg hover:bg-slate-50 transition-colors">
                        <div className="flex items-center gap-2 text-slate-500">
                            <span>{record.date}</span>
                        </div>
                        <div className="flex items-center gap-1">
                            <span className={`font-bold ${record.score>= 80 ? 'text-emerald-600' :
                                'text-slate-600'}`}>{record.score}</span>
                            <span className="text-[10px] text-slate-300">分</span>
                        </div>
                    </div>
                    ))}
                </div>
            </div>

        </aside>

    </main>
</div>
);
};

export default ArticleReader;