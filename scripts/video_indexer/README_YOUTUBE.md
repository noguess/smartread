# YouTube Video Indexer (V4.0) ä½¿ç”¨æŒ‡å—

æœ¬æŒ‡å—è¯¦ç»†ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨ `youtube_indexer.py` è„šæœ¬æ‰¹é‡å¤„ç† YouTube è§†é¢‘ï¼Œæå–ç”Ÿè¯ç´¢å¼•ã€‚

## ğŸš€ åŠŸèƒ½æ¦‚è¿°

è¯¥è„šæœ¬ä½¿ç”¨ `yt-dlp` ä¸‹è½½ YouTube è§†é¢‘éŸ³é¢‘ï¼Œä½¿ç”¨ `Whisper` è¿›è¡Œè¯­éŸ³è½¬æ–‡å­—ï¼Œé€šè¿‡ç‰¹å®šçš„ç®—æ³•æå–â€œè¢«æ•™æˆâ€çš„é‡ç‚¹å•è¯ï¼Œæœ€ç»ˆç”Ÿæˆå‰ç«¯å¯ç”¨çš„ JSON ç´¢å¼•æ–‡ä»¶ã€‚

**æ ¸å¿ƒç‰¹æ€§**:
- **æ‰¹é‡å¤„ç†**: æ”¯æŒ YouTube æ’­æ”¾åˆ—è¡¨ (Playlist)ã€é¢‘é“ (Channel) æ‰¹é‡æ‰«æã€‚
- **æ™ºèƒ½è¿‡æ»¤**: é€šè¿‡å¯†åº¦ã€ä¸Šä¸‹æ–‡ã€åŒè¯­ç¯å¢ƒç­‰å¤šç»´æ‰“åˆ†ç­›é€‰é‡ç‚¹è¯ã€‚
- **å¢é‡æ›´æ–°**: è‡ªåŠ¨è·³è¿‡å·²ä¸‹è½½/å·²è½¬å½•çš„è§†é¢‘ï¼Œæ”¯æŒæ–­ç‚¹ç»­ä¼ ã€‚
- **çµæ´»é…ç½®**: å¯è‡ªå®šä¹‰ç­›é€‰ä¸¥æ ¼ç¨‹åº¦ (`--min-score`)ã€‚

---

## ğŸ› ï¸ ç¯å¢ƒå‡†å¤‡

### 1. ç³»ç»Ÿä¾èµ–
ç¡®ä¿å·²å®‰è£… ffmpegï¼ˆWhisper è¯­éŸ³è¯†åˆ«ä¾èµ–å®ƒå¤„ç†éŸ³é¢‘ï¼‰ã€‚
```bash
# MacOS
brew install ffmpeg

# Ubuntu
sudo apt install ffmpeg
```

### 2. Python ä¾èµ–
```bash
pip install yt-dlp openai-whisper tqdm
```
*(æ³¨æ„: å¯èƒ½éœ€è¦ç§‘å­¦ä¸Šç½‘ç¯å¢ƒä»¥è®¿é—® YouTube)*

---

## ğŸ“– å¿«é€Ÿå¼€å§‹

### åœºæ™¯ 1: å¤„ç†å•ä¸ªè§†é¢‘
```bash
cd scripts/video_indexer
python youtube_indexer.py --urls "https://www.youtube.com/watch?v=aSd7R5gQZMc"
```

### åœºæ™¯ 2: æ‰¹é‡å¤„ç†æ’­æ”¾åˆ—è¡¨ (æ¨è)
ç›´æ¥ç²˜è´´ Playlist URLï¼Œè„šæœ¬ä¼šè‡ªåŠ¨è§£æåˆ—è¡¨ä¸­æ‰€æœ‰è§†é¢‘ã€‚
```bash
python youtube_indexer.py --urls "https://www.youtube.com/playlist?list=PLv62PVNSGzGDO6iCBvmGoKn30FksODEX6"
```

### åœºæ™¯ 3: è°ƒæ•´å•è¯ç­›é€‰é˜ˆå€¼ (çµæ´»æ§åˆ¶)
é»˜è®¤è¿‡æ»¤åˆ†æ•°ä¸º **5** åˆ†ã€‚
- **æ›´å®½æ¾ (ä¿ç•™æ›´å¤šè¯)**: `--min-score 3`
- **æ›´ä¸¥æ ¼ (åªä¿ç•™æ ¸å¿ƒè¯)**: `--min-score 8`

```bash
python youtube_indexer.py --urls "..." --min-score 3
```

### åœºæ™¯ 4: ä»…é‡æ–°ç”Ÿæˆç´¢å¼• (ä¸ä¸‹è½½)
å¦‚æœä½ å·²ç»ä¸‹è½½å¹¶è½¬å½•è¿‡è§†é¢‘ï¼Œåªæ˜¯æƒ³è°ƒæ•´ `--min-score` é‡æ–°ç”Ÿæˆç´¢å¼•ï¼š
```bash
python youtube_indexer.py --skip-download --min-score 8
```
*(æ³¨æ„: è¿™ä¼šå¤ç”¨ `temp_downloads_youtube/` ä¸‹çš„ç¼“å­˜æ–‡ä»¶ï¼Œé€Ÿåº¦éå¸¸å¿«)*

---

## ğŸ“‚ è¾“å‡ºæ–‡ä»¶ç»“æ„

å¤„ç†å®Œæˆåï¼Œç´¢å¼•æ•°æ®ä¼šè‡ªåŠ¨ä¿å­˜åˆ°é¡¹ç›®å‰ç«¯ç›®å½• `public/data/`ï¼š

| æ–‡ä»¶å | ç”¨é€” |
| :--- | :--- |
| `video_map_youtube.json` | æ‰€æœ‰ YouTube è§†é¢‘çš„å…ƒæ•°æ® (ID, æ ‡é¢˜) |
| `index_youtube_a.json` | ä»¥ 'A' å¼€å¤´çš„å•è¯ç´¢å¼•åˆ†ç‰‡ |
| `index_youtube_...` | å…¶ä»–å­—æ¯ç´¢å¼•åˆ†ç‰‡ |

å‰ç«¯ `src/services/videoIndexService.ts` ä¼šè‡ªåŠ¨è¯»å–è¿™äº›æ–‡ä»¶ã€‚

---

## â“ å¸¸è§é—®é¢˜ (FAQ)

### Q1: è¿è¡Œè„šæœ¬æ—¶æŠ¥é”™ `NameError: name 'global_index' is not defined`
è¿™æ˜¯ä¸€ä¸ªå·²çŸ¥ Bugï¼Œå·²åœ¨æœ€æ–°ç‰ˆä¿®å¤ã€‚è¯·ç¡®ä¿æ‹‰å–æœ€æ–°ä»£ç ã€‚

### Q2: ä¸‹è½½é€Ÿåº¦å¾ˆæ…¢æ€ä¹ˆåŠï¼Ÿ
è„šæœ¬åº•å±‚ä½¿ç”¨ `yt-dlp`ã€‚è¯·ç¡®ä¿ä½ çš„ç½‘ç»œç¯å¢ƒå¯ä»¥æµç•…è®¿é—® YouTubeã€‚è„šæœ¬ä¼šè‡ªåŠ¨é‡è¯•å¤±è´¥çš„ä¸‹è½½ã€‚

### Q3: å¦‚ä½•ç¡®è®¤å•è¯ç­›é€‰é€»è¾‘ï¼Ÿ
é€»è¾‘ä½äº `indexer_shared.py` çš„ `smart_filter_taught_words` å‡½æ•°ã€‚
- **åŸºç¡€åˆ†**: å‡ºç° 1 æ¬¡å¾— 1 åˆ†ã€‚
- **å¯†åº¦åˆ†**: çŸ­æ—¶é—´å¯†é›†é‡å¤å‡ºç°å¾— 2 åˆ†ã€‚
- **ä¸Šä¸‹æ–‡åˆ†**: å‡ºç° "è¿™ä¸ªå•è¯" / "æ„æ€æ˜¯" ç­‰å¼•å¯¼è¯å¾— 5 åˆ† (æƒé‡æœ€é«˜)ã€‚
- **åŒè¯­åˆ†**: ä¸Šä¸‹æ–‡åŒ…å«ä¸­æ–‡å¾— 2 åˆ†ã€‚

æ€»åˆ† >= `min_score` çš„å•è¯ä¼šè¢«å…¥åº“ã€‚

### Q4: ä¸´æ—¶æ–‡ä»¶åœ¨å“ªé‡Œï¼Ÿ
- éŸ³é¢‘å’Œè½¬å½•ç¼“å­˜ä¿å­˜åœ¨ `scripts/video_indexer/temp_downloads_youtube/`ã€‚
- å¦‚æœæƒ³å®Œå…¨é‡ç½®ï¼Œå¯ä»¥åˆ é™¤è¯¥æ–‡ä»¶å¤¹ã€‚

---

## ğŸ“ ç»´æŠ¤æŒ‡å—

å¦‚éœ€ä¿®æ”¹è¿‡æ»¤é€»è¾‘ï¼Œè¯·ç¼–è¾‘ `indexer_shared.py`ã€‚
å¦‚éœ€ä¿®æ”¹ YouTube ä¸‹è½½å‚æ•° (å¦‚ Cookie, Proxy)ï¼Œè¯·ç¼–è¾‘ `youtube_indexer.py` ä¸­çš„ `download_audio_youtube` å‡½æ•°ã€‚
