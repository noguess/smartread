# Smart Reader - 英语中考智能阅读平台产品需求文档 (综合版 v1.0)

## 1. 项目概况
**项目名称**: Smart Reader (英语中考智能阅读平台)
**当前版本**: V5.0 (累计版本)
**核心理念**: "在阅读中学习" - 将单词记忆与自适应阅读及测试深度融合。
**目标用户**: 初中生 (12-15岁)。
**适用终端**: iPad (首选), PC/Mac (Web浏览器)。
**技术栈**: 
- **Frontend**: React, TypeScript, Material-UI, Recharts
- **Storage**: Dexie.js (IndexedDB wrapper) - 全本地数据持久化
- **AI**: Deepseek API
- **Service Layer**:
    - `llmService`: 处理与 LLM 通信 (支持 Mock/Stream 模拟)
    - `wordService`: 管理单词生命周期与 SRS 算法
    - `articleService`: 文章生成与存储
    - `quizRecordService`: 测试记录管理

## 2. 产品架构与用户流程
系统围绕一个“闭环”学习过程展开：
1.  **选词**: 系统基于艾宾浩斯遗忘曲线自动推荐 + 用户手动添加生词。
2.  **生成**: AI 生成个性化阅读文章 (或从文库中检索)。
3.  **阅读**: 用户利用辅助工具 (翻译, TTS) 进行阅读。
4.  **测试**: 自适应试题检测理解程度和词汇掌握情况。
5.  **反馈**: 结果实时更新单词记忆状态 (SRS) 和文章难度等级。

## 3. 核心功能模块

### 3.1 单词管理与 SRS ("大脑")
*   **数据结构**: 每个单词包含 `status` (New-新词, Learning-学习中, Review-复习中, Mastered-已掌握), `interval` (间隔天数), `nextReviewAt` (下次复习时间)。
*   **数据导入**:
    *   **手动导入**: 设置 -> 导入核心词库。
    *   **去重机制**: 严格基于 `spelling` (拼写) 进行检测 (忽略大小写)，防止重复。
*   **艾宾浩斯算法 (SRSAlgorithm)**:
    *   **答对**: 增加 `interval` (指数增长) 并更新 `nextReviewAt`。
    *   **答错**: 重置 `interval` 为 1，状态设为 `Learning`。
    *   **选词逻辑**: 优先选择 "临界复习词" (今日到期) > "新词" > "已掌握词" (语感维持)。
*   **单词本 UI**:
    *   按状态分 Tab 展示 (`VocabularyPage`)。
    *   显示音标。
    *   支持搜索和手动修改状态。

### 3.2 文章系统 ("内容")
*   **生成模式**:
    *   **自动模式**: 系统自动挑选高优先级单词。
    *   **手动模式**: 用户手动选择特定单词或主题。
*   **文库 (Library) (V2.0 更新)**:
    *   **生成解耦**: 
        - `generateArticleOnly`: 仅生成文章标题、内容和核心词，不包含试题。
        - 文章生成后立即存入 `Articles` 表。
    *   "一文多测": 用户可以重新打开旧文章进行全新的测试。
    *   列表视图: 展示元数据 (难度, 核心词, 测试次数, 最高分)。
    *   **持久化**: 文库作为学习档案永久保存，默认不支持删除操作，以保证学习数据的完整性。
*   **生成体验 (UX)**:
    *   **Loading**: 使用估算进度条 (基于 `llmService` 回调) + 文本状态提示。
    *   *注: 目前暂未实现真流式 (Streaming) 渲染，采用整体生成后展示。*

### 3.3 阅读体验
*   **UI/UX (V2.0)**:
    *   Material 3 设计风格。
    *   排版优化 (最大宽度 680px, 舒适行高)。
    *   核心词高亮显示 (可点击)。
*   **阅读辅助**:
    *   **全局查词 (V3.0)**: 点击单词 -> 弹出模态框 (`WordDetailModal`)，包含释义、音标、TTS 朗读 (Web Speech API) 和本地视频讲解 (如果有, 否则 fallback 到 Free Dictionary API)。
        *   **视频置顶 (V5.1)**: 用户可手动置顶某个视频片段 (Pin)，该片段将自动排序至首位并作为默认播放项。
        *   **默认视频源 (V5.2)**: 默认使用 YouTube，用户可在设置中切换为 Bilibili。
    *   **国际化 (i18n)**: 支持中/英文界面一键切换。

### 3.4 首次使用引导 (Onboarding) (V5.2)
*   **触发机制**: 新用户首次进入时自动弹出。
*   **流程**: Welcome -> API Key 设置 (强制) -> 词库导入 (可跳过)。
*   **API Key**: 默认引导至 Deepseek 获取 Key。
*   **初始词库**: 提供中考高频 666 词一键导入。

### 3.5 自适应测试系统 ("检测")
*   **即时测试**: 在阅读页点击 "开始测试"，调用 `generateQuizForArticle` 实时生成。
*   **难度分级 (V4.0)**:
    *   **L1 (基础)**: CEFR A1. 侧重再认。
    *   **L2 (进阶)**: CEFR A2. 侧重回忆。
    *   **L3 (挑战)**: CEFR B1. 侧重应用。
*   **题型实现**:
    *   **阅读理解**: 单选题 (`choice`)。
    *   **词汇专项**:
        *   `cloze`: 选词填空 (基于文章原句)。
        *   `definition`: 释义匹配。
        *   `spelling`: 拼写输入。
        *   `contextual`: 新语境填空。
        *   `wordForm`: 词形变换。
        *   `matching`: 连线题。
*   **自适应逻辑**:
    *   连续 3 次满分 + 反馈"简单" -> 升级难度。
    *   连续 2 次不及格 + 反馈"太难" -> 降级难度。

### 3.5 统计与分析
*   **学习时长 (V3.0)**: `ReadingTimer` 自动记录阅读和做题页面的停留时长。
*   **投入度 (V5.0)**: 首页展示 "连续学习天数" 和 "累计学习时长"。
*   **历史记录**: 可视化展示测试成绩和趋势 (`StatisticsPage`)。

### 3.6 设置
*   **配置**: API Key, 每日新词上限。
*   **文章长度 (V5.0)**:
    *   Short (400词) / Medium (600词) / Long (800词)。
*   **数据管理**:
    *   **重置进度**: 需密码 ("admin") 确认。清除历史/状态但保留单词释义。
    *   **备份/恢复**: JSON 格式导入导出。


### 3.7 每日特训 (Daily Word Drill) (V5.3)
*   **训练流程**: 
    - **Round 1: 影子跟读 (Shadowing)**: TTS 播放，用户跟读，开启 En-ASR 实时反馈。
    - **Round 2: 自主朗读 (Self-Reading)**: 无声音提示，用户自主朗读，开启 En-ASR 验证。
    - **Round 3: 看英识义 (En->Zh)**: 看到英文，口述中文释义，开启 Zh-ASR 并调用 AI 异步评分。
    - **Round 4: 听音检义 (Audio->Zh)**: 听到读音，口述中文释义，开启 Zh-ASR 并调用 AI 异步评分。
*   **终极考核 (Exam)**: 
    - 两步验证：首先正确读出单词，然后口述中文释义。
    - **批量评分**: 为了性能考虑，考试期间仅记录录音转录文本，在考试结束时一次性提交给 AI 进行批量评分。
*   **状态更新**: 通过考核的单词会获得 SM-2 算法的高质量评分 (Grade 4/5)，显著延长复习周期。

## 4. 数据字典 (Schema)

**注意**: 本表格仅描述核心业务实体的逻辑定义。
具体的数据库物理模型、字段类型 (TypeScript Interfaces) 及 ER 关系，请务必以 **[ARCHITECTURE.md](../../ARCHITECTURE.md)** 为唯一真理来源 (SSOT)。

### 核心实体
*   **Words (单词)**: 学习的核心单元。包含拼写、释义、音标，以及 SRS 算法所需的状态 (`status`)、下次复习时间 (`nextReviewAt`) 和间隔数据。
*   **Articles (文章)**: 阅读内容载体。包含 Markdown 内容、难度等级 (`L1-L3`) 以及关联的核心词汇表。
*   **QuizRecords (测试记录)**: 学习成果的快照。记录了用户对特定文章的测试得分、做题时长、所选题目的快照以及难度反馈。

## 5. UI 结构
*   **首页 (Home)**: 仪表盘 (连续天数, 快速开始), 文库预览。
*   **文库 (Library)**: 所有文章列表。
*   **单词本 (Word Book)**: 单词管理与复习。
*   **统计 (Statistics)**: 时长与进度图表。
*   **设置 (Settings)**: 系统配置与数据工具。
