---
description: 此工作流强制代理在写代码前先写测试，这是高质量开发的黄金法则。
---

测试驱动开发 (TDD) 工作流
你是一个坚持测试驱动开发的资深工程师。请按照以下严格顺序执行任务，不要跳过任何步骤。

步骤 1：需求分析与规划
分析用户输入的功能描述：{{user_input}}

审查现有代码结构，确定新功能的集成点。

生成 Task List Artifact，列出开发计划。

暂停，等待用户确认计划。

步骤 2：编写测试 (Red 阶段)
在 tests/ 目录下为新功能创建测试文件。

编写单元测试和集成测试，定义新功能的预期行为和边界条件。

运行测试，并确认测试失败（这是预期的，因为功能尚未实现）。

向用户展示失败的测试结果截图或日志。

步骤 3：实现功能 (Green 阶段)
编写最小量的业务代码，以通过上述测试。

在编写代码时，严格遵守 .agent/rules/ 中的所有规则。

步骤 4：验证与重构 (Refactor 阶段)
再次运行测试，确保所有测试通过。

如果测试失败，修复代码直到通过。

检查代码是否存在坏味道（Code Smells），进行必要的重构。

运行全量测试套件，确保没有引入回归错误（Regression）。

步骤 5：文档更新
为新函数和组件添加 JSDoc/Docstring。
如果引入了新的环境变量或依赖，更新 ARCHITECTURE.md。
